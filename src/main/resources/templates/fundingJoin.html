<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>펀딩 참여, 수정 및 삭제하기</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        .container {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            width: 100%;
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
        }
        input[type="number"],
        input[type="checkbox"],
        input[type="text"] {
            width: calc(100% - 20px);
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        input[type="checkbox"] {
            width: auto;
        }
        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        .checkbox-group label {
            margin: 0 0 0 5px;
        }
        button {
            width: 100%;
            padding: 10px;
            background-color: #28a745;
            color: #fff;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            margin-bottom: 10px;
        }
        button.delete {
            background-color: #dc3545;
        }
        button.delete:hover {
            background-color: #c82333;
        }
        button:hover {
            background-color: #218838;
        }
    </style>
    <script>
        function isValidFundingAmount(amount) {
            return amount % 5000 === 0;
        }

        async function joinFunding() {
            const fundingForm = document.getElementById("fundingForm");
            const fundingsId = parseInt(fundingForm.fundingsId.value);
            const userId = parseInt(fundingForm.userId.value);
            const fundingAmount = parseInt(fundingForm.fundingAmount.value);
            const nameUndisclosed = fundingForm.nameUndisclosed.checked ? 'Y' : 'N';
            const amountUndisclosed = fundingForm.amountUndisclosed.checked ? 'Y' : 'N';

            if (!isValidFundingAmount(fundingAmount)) {
                alert("펀딩 금액은 5000원 단위여야 합니다.");
                return;
            }

            const requestBody = {
                fundingsId: fundingsId,
                userId: userId,
                fundingAmount: fundingAmount,
                nameUndisclosed: nameUndisclosed,
                amountUndisclosed: amountUndisclosed
            };

            try {
                const response = await fetch('/api/fundings/join', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });

                if (response.ok) {
                    const result = await response.json();
                    alert("펀딩 참여 성공! 참여 ID: " + result.fundingJoinId);
                } else {
                    const errorText = await response.text();
                    if (errorText === "User ID does not exist") {
                        alert("유저 아이디가 존재하지 않습니다.");
                    } else if (errorText === "Fundings ID does not exist") {
                        alert("펀딩 아이디가 존재하지 않습니다.");
                    } else {
                        alert("펀딩 참여 실패: " + errorText);
                    }
                }
            } catch (error) {
                console.error('Error:', error);
                alert("펀딩 참여 중 오류 발생!");
            }
        }

        async function updateFunding() {
            const updateForm = document.getElementById("updateForm");
            const fundingJoinId = parseInt(updateForm.fundingJoinId.value);
            const fundingAmount = parseInt(updateForm.fundingAmount.value);
            const nameUndisclosed = updateForm.nameUndisclosed.checked ? 'Y' : 'N';
            const amountUndisclosed = updateForm.amountUndisclosed.checked ? 'Y' : 'N';

            if (!isValidFundingAmount(fundingAmount)) {
                alert("펀딩 금액은 5000원 단위여야 합니다.");
                return;
            }

            const requestBody = {
                fundingJoinId: fundingJoinId,
                fundingAmount: fundingAmount,
                nameUndisclosed: nameUndisclosed,
                amountUndisclosed: amountUndisclosed
            };

            try {
                const response = await fetch('/api/fundings/update', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });

                if (response.ok) {
                    const result = await response.json();
                    alert("펀딩 수정 성공! 수정된 참여 ID: " + result.fundingJoinId);
                } else {
                    const errorText = await response.text();
                    alert("펀딩 수정 실패: " + errorText);
                }
            } catch (error) {
                console.error('Error:', error);
                alert("펀딩 수정 중 오류 발생!");
            }
        }

        async function deleteFunding() {
            const updateForm = document.getElementById("updateForm");
            const fundingJoinId = parseInt(updateForm.fundingJoinId.value);

            try {
                const response = await fetch(`/api/fundings/delete/${fundingJoinId}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    alert("펀딩 삭제 성공!");
                } else {
                    const errorText = await response.text();
                    alert("펀딩 삭제 실패: " + errorText);
                }
            } catch (error) {
                console.error('Error:', error);
                alert("펀딩 삭제 중 오류 발생!");
            }
        }
    </script>
</head>
<body>
    <div class="container">
        <h1>펀딩 참여하기</h1>
        <form id="fundingForm" onsubmit="event.preventDefault(); joinFunding();">
            <label for="fundingsId">펀딩 ID:</label>
            <input type="number" id="fundingsId" name="fundingsId" required>

            <label for="userId">사용자 ID:</label>
            <input type="number" id="userId" name="userId" required>

            <label for="fundingAmount">펀딩 금액 (5000원 단위):</label>
            <input type="number" id="fundingAmount" name="fundingAmount" step="5000" required>

            <div class="checkbox-group">
                <input type="checkbox" id="nameUndisclosed" name="nameUndisclosed">
                <label for="nameUndisclosed">이름 비공개</label>
            </div>

            <div class="checkbox-group">
                <input type="checkbox" id="amountUndisclosed" name="amountUndisclosed">
                <label for="amountUndisclosed">금액 비공개</label>
            </div>

            <button type="submit">펀딩 참여하기</button>
        </form>

        <h1>펀딩 참여 수정 및 삭제하기</h1>
        <form id="updateForm" onsubmit="event.preventDefault();">
            <label for="fundingJoinId">참여 ID:</label>
            <input type="number" id="fundingJoinId" name="fundingJoinId" required>

            <label for="fundingAmount">펀딩 금액 (5000원 단위):</label>
            <input type="number" id="fundingAmount" name="fundingAmount" step="5000" required>

            <div class="checkbox-group">
                <input type="checkbox" id="nameUndisclosed" name="nameUndisclosed">
                <label for="nameUndisclosed">이름 비공개</label>
            </div>

            <div class="checkbox-group">
                <input type="checkbox" id="amountUndisclosed" name="amountUndisclosed">
                <label for="amountUndisclosed">금액 비공개</label>
            </div>

            <button type="submit" onclick="updateFunding()">펀딩 수정하기</button>
            <button type="submit" class="delete" onclick="deleteFunding()">펀딩 삭제하기</button>
        </form>
    </div>
</body>
</html>



