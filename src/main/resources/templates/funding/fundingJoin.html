<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://java.sun.com/JSP/Page"
    layout:decorate="~{common/layouts/layout}">
<head>
    <link rel="stylesheet" type="text/css" th:href="@{/css/fundingJoin.css}">
    <script>
    
    	// 금액 단위 확인
        function isValidFundingAmount(amount) {
            return amount % 5000 === 0;
        }

        
        // 펀딩 참여 버튼 클릭
        async function joinFunding() {
            const fundingForm = document.getElementById("fundingForm");
            const fundingAmount = parseInt(fundingForm.fundingAmount.value);
            const nameUndisclosed = fundingForm.nameUndisclosed.checked ? 'Y' : 'N';
            const amountUndisclosed = fundingForm.amountUndisclosed.checked ? 'Y' : 'N';

            if (!isValidFundingAmount(fundingAmount)) {
                alert("펀딩 금액은 5000원 단위여야 합니다.");
                return;
            }

            const requestBody = {
                fundingsId: fundingForm.fundingsId.value,
                userId: fundingForm.userId.value,
                fundingAmount: fundingAmount,
                nameUndisclosed: nameUndisclosed,
                amountUndisclosed: amountUndisclosed
            };

            try {
                const response = await fetch('/api/fundings/join', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });

                if (response.ok) {
                    const result = await response.json();
                    alert("펀딩 참여 성공! 참여 ID: " + result.fundingJoinId);
                    
                } else {
                    const errorText = await response.text();
                    alert("펀딩 참여 실패: " + errorText);
                }
                
            } catch (error) {
                console.error('Error:', error);
                alert("펀딩 참여 중 오류 발생!");
            }
        }
    </script>
</head>
<body>
	<div layout:fragment="content">
	    <div class="funding-join-container">
	        <form id="fundingForm" class="funding-join-form" onsubmit="event.preventDefault(); joinFunding();">
	            <h1>펀딩 참여</h1>
	            
	            <label for="fundingAmount">펀딩 금액 (5000원 단위):</label>
	            <input type="number" id="fundingAmount" name="fundingAmount" step="5000" required>
	
	            <div class="checkbox-group">
	                <input type="checkbox" id="nameUndisclosed" name="nameUndisclosed">
	                <label for="nameUndisclosed">이름 비공개</label>
	            </div>
	
	            <div class="checkbox-group">
	                <input type="checkbox" id="amountUndisclosed" name="amountUndisclosed">
	                <label for="amountUndisclosed">금액 비공개</label>
	            </div>
	
	            <button type="submit">펀딩 참여하기</button>
	        </form>
	    </div>
    </div>
</body>
</html>